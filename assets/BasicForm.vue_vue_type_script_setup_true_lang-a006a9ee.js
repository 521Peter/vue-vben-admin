var Re=Object.defineProperty;var be=Object.getOwnPropertySymbols;var Se=Object.prototype.hasOwnProperty,Ne=Object.prototype.propertyIsEnumerable;var Fe=(n,r,s)=>r in n?Re(n,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[r]=s,L=(n,r)=>{for(var s in r||(r={}))Se.call(r,s)&&Fe(n,s,r[s]);if(be)for(var s of be(r))Ne.call(r,s)&&Fe(n,s,r[s]);return n};var x=(n,r,s)=>new Promise((o,A)=>{var l=c=>{try{w(s.next(c))}catch(h){A(h)}},p=c=>{try{w(s.throw(c))}catch(h){A(h)}},w=c=>c.done?o(c.value):Promise.resolve(c.value).then(l,p);w((s=s.apply(n,r)).next())});import{u as t,g as Ce,c as X,w as Z,am as ke,x as Ae,H as we,h as He,d as Ke,J as Ue,r as Ie,f as z,o as We,Z as ue,a8 as Ve,a9 as oe,l as Te,N as ie,_ as Ye,aa as de,ad as Be,ai as pe,aj as he,F as Xe,ac as Ee,ak as qe}from"./vue-f962b0e4.js";import{_ as Ge}from"./FormItem.vue_vue_type_script_lang-ff9da6df.js";import{b as Je,c as ze,_ as Ze}from"./BasicForm.vue_vue_type_style_index_0_lang-81a6c1be.js";import{h as Me,i as re,d as _e,a as Qe}from"./helper-b57cb88d.js";import{G as W,H as M,I as H,F as et,u as je,J as De,K as me,d as Le,f as tt}from"./index.js";import{e as le,k as ce,s as q,ab as ye,ae as Oe,d as Q,t as xe,f as G,a8 as nt,af as st,ag as at,R as ot,a0 as it}from"./antd-c4849d31.js";import{u as rt}from"./index-07f03dcb.js";function ct(n,r,s){const o=/^\[(.+)\]$/;if(o.test(n)){const A=n.match(o);if(A&&A[1]){const l=A[1].split(",");return r=Array.isArray(r)?r:[r],l.forEach((p,w)=>{q(s,p.trim(),r[w])}),!0}}}function lt(n,r,s){const o=/^\{(.+)\}$/;if(o.test(n)){const A=n.match(o);if(A&&A[1]){const l=A[1].split(",");return r=W(r)?r:{},l.forEach(p=>{q(s,p.trim(),r[p.trim()])}),!0}}}function ft({defaultValueRef:n,getSchema:r,formModel:s,getProps:o}){function A(c){var F,E;if(!W(c))return{};const h={};for(const T of Object.entries(c)){let[,u]=T;const[d]=T;if(!d||M(u)&&u.length===0||le(u))continue;const D=t(o).transformDateFunc;W(u)&&(u=D==null?void 0:D(u)),M(u)&&((F=u[0])!=null&&F.format)&&((E=u[1])!=null&&E.format)&&(u=u.map(y=>D==null?void 0:D(y))),ce(u)&&(u===""?u=void 0:u=u.trim()),!ct(d,u,h)&&!lt(d,u,h)&&q(h,d,u)}return l(h)}function l(c){const h=t(o).fieldMapToTime;if(!h||!Array.isArray(h))return c;for(const[F,[E,T],u="YYYY-MM-DD"]of h){if(!F||!E||!T)continue;if(!ye(c,F)){Oe(c,F);continue}const[d,D]=ye(c,F),[y,b]=Array.isArray(u)?u:[u,u];!Q(d)&&!xe(d)&&q(c,E,p(d,y)),!Q(D)&&!xe(D)&&q(c,T,p(D,b)),Oe(c,F)}return c}function p(c,h){return h==="timestamp"?H(c).unix():h==="timestampStartDay"?H(c).startOf("day").unix():H(c).format(h)}function w(){const c=t(r),h={};c.forEach(F=>{const{defaultValue:E,defaultValueObj:T}=F,u=Object.keys(T||{});u.length&&u.map(d=>{h[d]=T[d],s[d]===void 0&&(s[d]=T[d])}),Q(E)||(h[F.field]=E,s[F.field]===void 0&&(s[F.field]=E))}),n.value=G(h)}return{handleFormValues:A,initDefault:w}}const Y=24;function ut({advanceState:n,emit:r,getProps:s,getSchema:o,formModel:A,defaultValueRef:l}){const p=Ce(),{realWidthRef:w,screenEnum:c,screenRef:h}=et(),F=X(()=>{if(!n.isAdvanced)return 0;const y=t(s).emptySpan||0;if(nt(y))return y;if(W(y)){const{span:b=0}=y,_=t(h);return y[_.toLowerCase()]||b||0}return 0}),E=je(d,30);Z([()=>t(o),()=>n.isAdvanced,()=>t(w)],()=>{const{showAdvancedButton:y}=t(s);y&&E()},{immediate:!0});function T(y,b=0,_=!1){const P=t(w),C=parseInt(y.md)||parseInt(y.xs)||parseInt(y.sm)||y.span||Y,$=parseInt(y.lg)||C,N=parseInt(y.xl)||$,R=parseInt(y.xxl)||N;return P<=c.LG?b+=C:P<c.XL?b+=$:P<c.XXL?b+=N:b+=R,_?(n.hideAdvanceBtn=!1,b<=Y*2?(n.hideAdvanceBtn=!0,n.isAdvanced=!0):b>Y*2&&b<=Y*(t(s).autoAdvancedLine||3)?n.hideAdvanceBtn=!1:n.isLoad||(n.isLoad=!0,n.isAdvanced=!n.isAdvanced),{isAdvanced:n.isAdvanced,itemColSum:b}):b>Y*(t(s).alwaysShowLines||1)?{isAdvanced:n.isAdvanced,itemColSum:b}:{isAdvanced:!0,itemColSum:b}}const u=ke({});function d(){var P;let y=0,b=0;const{baseColProps:_={}}=t(s);for(const C of t(o)){const{show:$,colProps:N}=C;let R=!0;if(st($)&&(R=$),le($)&&(R=$({schema:C,model:A,field:C.field,values:L(L({},t(l)),A)})),R&&(N||_)){const{itemColSum:K,isAdvanced:J}=T(L(L({},_),N),y);y=K||0,J&&(b=y),u[C.field]=J}}(P=p==null?void 0:p.proxy)==null||P.$forceUpdate(),n.actionSpan=b%Y+t(F),T(t(s).actionColOptions||{span:Y},y,!0),r("advanced-change")}function D(){n.isAdvanced=!n.isAdvanced}return{handleToggleAdvanced:D,fieldsIsAdvancedMap:u}}function dt(n,r={}){const s=/^\[(.+)\]$/;if(s.test(n)){const o=n.match(s);if(o&&o[1]){const A=o[1].split(",");if(!A.length)return;const l=[];return A.forEach((p,w)=>{q(l,w,r[p.trim()])}),l.filter(Boolean).length?l:void 0}}}function pt(n,r={}){const s=/^\{(.+)\}$/;if(s.test(n)){const o=n.match(s);if(o&&o[1]){const A=o[1].split(",");if(!A.length)return;const l={};return A.forEach(p=>{q(l,p.trim(),r[p.trim()])}),Object.values(l).filter(Boolean).length?l:void 0}}}function ht({emit:n,getProps:r,formModel:s,getSchema:o,defaultValueRef:A,formElRef:l,schemaRef:p,handleFormValues:w}){function c(){return x(this,null,function*(){const{resetFunc:e,submitOnReset:a}=t(r);e&&le(e)&&(yield e()),t(l)&&(Object.keys(s).forEach(i=>{const m=t(o).find(O=>O.field===i),g=m==null?void 0:m.defaultValueObj,B=Object.keys(g||{});B.length&&B.map(O=>{s[O]=g[O]}),s[i]=mt(m,A,i)}),Ae(()=>N()),n("reset",we(s)),a&&K())})}const h=()=>t(o).map(e=>[...e.fields||[],e.field]).flat(1).filter(Boolean);function F(e){return x(this,null,function*(){if(Object.keys(e).length===0)return;const a=h(),v=".",i=a.filter(g=>String(g).indexOf(v)>=0),m=[];a.forEach(g=>{const B=t(o).find(V=>V.field===g);let O=ye(e,g);const fe=Reflect.has(e,g);O=Me(B==null?void 0:B.component,O);const{componentProps:ee}=B||{};let S=ee;typeof ee=="function"&&(S=S({formModel:t(s),formActionType:J}));const te=dt(g,e)||pt(g,e);if(fe||te){const V=te||O;if(_(g))if(Array.isArray(V)){const U=[];for(const f of V)U.push(f?H(f):null);t(s)[g]=U}else t(s)[g]=V?S!=null&&S.valueFormat?V:H(V):null;else t(s)[g]=V;S!=null&&S.onChange&&(S==null||S.onChange(V)),m.push(g)}else i.forEach(V=>{try{const U=V.split(".").reduce((f,j)=>f[j],e);De(U)&&(t(s)[V]=t(U),m.push(V))}catch(U){De(A.value[V])&&(t(s)[V]=G(t(A.value[V])))}})}),P(m).catch(g=>{})})}function E(e){return x(this,null,function*(){const a=G(t(o));if(!e)return;let v=ce(e)?[e]:e;ce(e)&&(v=[e]);for(const i of v)T(i,a);p.value=a})}function T(e,a){if(ce(e)){const v=a.findIndex(i=>i.field===e);v!==-1&&(delete s[e],a.splice(v,1))}}function u(e,a,v=!1){return x(this,null,function*(){const i=G(t(o)),m=Array.isArray(e)?e.map(O=>O.field):[e.field];if(i.find(O=>m.includes(O.field))){me("There are schemas that have already been added");return}const g=i.findIndex(O=>O.field===a),B=W(e)?[e]:e;!a||g===-1||v?v?i.unshift(...B):i.push(...B):g!==-1&&i.splice(g+1,0,...B),p.value=i,y(e)})}function d(e){return x(this,null,function*(){let a=[];if(W(e)&&a.push(e),M(e)&&(a=[...e]),!a.every(i=>re(i.component)||Reflect.has(i,"field")&&i.field)){me("All children of the form Schema array that need to be updated must contain the `field` field");return}p.value=a})}function D(e){return x(this,null,function*(){let a=[];if(W(e)&&a.push(e),M(e)&&(a=[...e]),!a.every(m=>re(m.component)||Reflect.has(m,"field")&&m.field)){me("All children of the form Schema array that need to be updated must contain the `field` field");return}const i=[];t(o).forEach(m=>{let g;if(a.forEach(B=>{m.field===B.field&&(g=B)}),g!==void 0&&m.field===g.field){const B=Le(m,g);i.push(B)}else i.push(m)}),y(i),p.value=at(i,"field")})}function y(e){let a=[];W(e)&&a.push(e),M(e)&&(a=[...e]);const v={},i=b();a.forEach(m=>{!re(m.component)&&Reflect.has(m,"field")&&m.field&&!Q(m.defaultValue)&&(!(m.field in i)||Q(i[m.field]))&&(v[m.field]=m.defaultValue)}),F(v)}function b(){return t(l)?w(we(t(s))):{}}function _(e){return t(o).some(a=>a.field===e&&a.component?_e.includes(a.component):!1)}function P(e){return x(this,null,function*(){var v;const a=yield(v=t(l))==null?void 0:v.validateFields(e);return w(a)})}function C(e){return x(this,null,function*(){var a;yield(a=t(l))==null?void 0:a.setProps(e)})}function $(e){return x(this,null,function*(){var i;let a;e===void 0?a=h():a=e===Array.isArray(e)?e:void 0;const v=yield(i=t(l))==null?void 0:i.validate(a);return w(v)})}function N(e){return x(this,null,function*(){var a;yield(a=t(l))==null?void 0:a.clearValidate(e)})}function R(e,a){return x(this,null,function*(){var v;yield(v=t(l))==null?void 0:v.scrollToField(e,a)})}function K(e){return x(this,null,function*(){e&&e.preventDefault();const{submitFunc:a}=t(r);if(a&&le(a)){yield a();return}if(t(l))try{const i=yield $();n("submit",i)}catch(i){if((i==null?void 0:i.outOfDate)===!1&&(i!=null&&i.errorFields))return;throw new Error(i)}})}const J={getFieldsValue:b,setFieldsValue:F,resetFields:c,updateSchema:D,resetSchema:d,setProps:C,removeSchemaByField:E,appendSchemaByField:u,clearValidate:N,validateFields:P,validate:$,submit:K,scrollToField:R};return{handleSubmit:K,clearValidate:N,validate:$,validateFields:P,getFieldsValue:b,updateSchema:D,resetSchema:d,appendSchemaByField:u,removeSchemaByField:E,resetFields:c,setFieldsValue:F,scrollToField:R}}function mt(n,r,s){let o=G(r.value[s]);return At(n)?o||"":(!o&&n&&yt(n)&&(o=[0,0]),!o&&n&&n.component==="ApiTree"&&(o=[]),o)}function yt(n){if(n.component==="Slider"&&n.componentProps&&"range"in n.componentProps)return!0}function At(n){return(n==null?void 0:n.component)&&Qe.includes(n.component)}function vt(A){return x(this,arguments,function*({getSchema:n,getProps:r,formElRef:s,isInitedDefault:o}){He(()=>x(this,null,function*(){if(t(o)||!t(r).autoFocusFirstItem)return;yield Ae();const l=t(n),p=t(s),w=p==null?void 0:p.$el;if(!p||!w||!l||l.length===0)return;const c=l[0];if(!c.component||!c.component.includes("Input"))return;const h=w.querySelector(".ant-row:first-child input");h&&(h==null||h.focus())}))})}const Et=Ke({name:"BasicForm",__name:"BasicForm",props:Je,emits:["advanced-change","reset","submit","register","field-value-change"],setup(n,{expose:r,emit:s}){const o=n,A=Ue(),l=Ie({}),p=rt(),w=Ie({isAdvanced:!0,hideAdvanceBtn:!1,isLoad:!1,actionSpan:6}),c=z({}),h=z(!1),F=z(),E=z(null),T=z(null),{prefixCls:u}=tt("basic-form"),d=X(()=>L(L({},o),t(F))),D=X(()=>[u,{[`${u}--compact`]:t(d).compact}]),y=X(()=>{const{baseRowStyle:f={},rowProps:j}=t(d);return L({style:f},j)}),b=X(()=>L(L(L({},A),o),t(d))),_=X(()=>{var j;const f=t(E)||t(d).schemas;for(const I of f){const{defaultValue:k,component:ne,componentProps:se={},isHandleDateDefaultValue:Pe=!0}=I;if(Pe&&k&&ne&&_e.includes(ne)){const $e={schema:I,tableAction:(j=o.tableAction)!=null?j:{},formModel:l,formActionType:{}},ae=se?typeof se=="function"?se($e).valueFormat:se.valueFormat:null;if(!Array.isArray(k))I.defaultValue=ae?H(k).format(ae):H(k);else{const ve=[];k.forEach(ge=>{ve.push(ae?H(ge).format(ae):H(ge))}),I.defaultValue=ve}}}return t(d).showAdvancedButton?G(f.filter(I=>!re(I.component))):G(f)}),{handleToggleAdvanced:P,fieldsIsAdvancedMap:C}=ut({advanceState:w,emit:s,getProps:d,getSchema:_,formModel:l,defaultValueRef:c}),{handleFormValues:$,initDefault:N}=ft({getProps:d,defaultValueRef:c,getSchema:_,formModel:l});vt({getSchema:_,getProps:d,isInitedDefault:h,formElRef:T});const{handleSubmit:R,setFieldsValue:K,clearValidate:J,validate:e,validateFields:a,getFieldsValue:v,updateSchema:i,resetSchema:m,appendSchemaByField:g,removeSchemaByField:B,resetFields:O,scrollToField:fe}=ht({emit:s,getProps:d,formModel:l,getSchema:_,defaultValueRef:c,formElRef:T,schemaRef:E,handleFormValues:$});ze({resetAction:O,submitAction:R}),Z(()=>t(d).model,()=>{const{model:f}=t(d);f&&K(f)},{immediate:!0}),Z(()=>o.schemas,f=>{m(f!=null?f:[])}),Z(()=>_.value,f=>{Ae(()=>{var j;(j=p==null?void 0:p.redoModalHeight)==null||j.call(p)}),!t(h)&&f!=null&&f.length&&(N(),h.value=!0)}),Z(()=>l,je(()=>{t(d).submitOnChange&&R()},300),{deep:!0});function ee(f){return x(this,null,function*(){F.value=Le(t(F)||{},f)})}function S(f,j,I){l[f]=j,s("field-value-change",f,j),I&&I.itemProps&&!I.itemProps.autoLink&&a([f]).catch(k=>{})}function te(f){const{autoSubmitOnEnter:j}=t(d);if(j&&f.key==="Enter"&&f.target&&f.target instanceof HTMLElement){const I=f.target;I&&I.tagName&&I.tagName.toUpperCase()=="INPUT"&&R()}}const V={getFieldsValue:v,setFieldsValue:K,resetFields:O,updateSchema:i,resetSchema:m,setProps:ee,removeSchemaByField:B,appendSchemaByField:g,clearValidate:J,validateFields:a,validate:e,submit:R,scrollToField:fe},U=X(()=>L(L({},d.value),w));return r(L({},V)),We(()=>{N(),s("register",V)}),(f,j)=>(ue(),Ve(t(it),Ee(b.value,{class:D.value,ref_key:"formElRef",ref:T,model:l,onKeypress:qe(te,["enter"])}),{default:oe(()=>[Te(t(ot),pe(he(y.value)),{default:oe(()=>[ie(f.$slots,"formHeader"),(ue(!0),Ye(Xe,null,de(_.value,I=>(ue(),Ve(Ge,{key:I.field,isAdvanced:t(C)[I.field],tableAction:f.tableAction,formActionType:V,schema:I,formProps:d.value,allDefaultValues:c.value,formModel:l,setFormModel:S},Be({_:2},[de(Object.keys(f.$slots),k=>({name:k,fn:oe(ne=>[ie(f.$slots,k,pe(he(ne||{})))])}))]),1032,["isAdvanced","tableAction","schema","formProps","allDefaultValues","formModel"]))),128)),Te(Ze,Ee(U.value,{onToggleAdvanced:t(P)}),Be({_:2},[de(["resetBefore","submitBefore","advanceBefore","advanceAfter"],I=>({name:I,fn:oe(k=>[ie(f.$slots,I,pe(he(k||{})))])}))]),1040,["onToggleAdvanced"]),ie(f.$slots,"formFooter")]),_:3},16)]),_:3},16,["class","model","onKeypress"]))}});export{Et as _};
